---
title: "phyto_test.Rに対応したR Notebook"
output: html_notebook
---
## 第4章の内容
### 4.2 エクセルを使ってメタデータをまとめる
```{r}
#メタデータの取り込み
phyto_metadata <- read.csv("metadata_phyto.csv", header=T) #load file list
#読み込まれた内容の確認
phyto_metadata
```

```{r}
#年月日に何種類あるか、一覧を確認
levels(as.factor(phyto_metadata$YYMMDD))
##年月日に何種類あるか、その種類数を計算
length(levels(as.factor(phyto_metadata$YYMMDD)))
```
### 4.3 Rプログラミングの基礎(if, loop, 関数)
https://tksmiki.github.io/test_R/chapter04_05/chapter04_4-3.nb.html

### 4.4 メタデータを活用した大量のデータの自動読み込み
植物プランクトンの種組成データを読み込む
```{r}
#ファイル名の一覧を確認してみる。
phyto_metadata$file
####load each data###############
#空のリストを生成する
raw_data <- list() #prepare empty list
#必要なファイル数をlength()関数を使って計算し, no_sampleに代入する
no_sample <- length(phyto_metadata$file)
for(i in 1:no_sample) {#１からno_sampleまでループを繰り返す
  print(i)　#今何番目のループかがわかるようにiの値をコンソールに出力する
  #phyto_metadata$fileベクトルの各要素からファイル名を指定してデータを読み込み，リストの各要素に代入していく
  raw_data[[i]] <- read.csv(as.character(phyto_metadata$file[i]), header = T)
}
```
読み込まれたリストの3番目の要素について，その冒頭部分だけをhead()関数を使って確認してみる
```{r}
head(raw_data[[3]])
```
全体を確認してもよい
```{r}
raw_data[[3]]
```

## ここから第5章の内容
### 5.1.1 エクセルを用いたデータ保存での保存形式のミス

エラーが起きるように意図したメタデータファイルを読み込んでエラーを再現
```{r}
###For Chapter 5: Section 5.1#######
phyto_metadata <- read.csv("metadata_phyto_e1.csv", header = T) #load file list
```

Rのバージョンが古いときのみ、次のfor loopでエラーが生じる
```{r error = TRUE}
####load each data###############
raw_data <- list() #prepare empty list
no_sample <- length(phyto_metadata$file)
for(i in 1:no_sample) {
  print(i)
  raw_data[[i]] <- read.csv(as.character(phyto_metadata$file[i]), header = T)
}
```
エラーが起きている3番目のファイルは何？
```{r}
phyto_metadata$file[3]
```
"20181004_1_ryuko_e1.csv"の保存形式を「CSV(コンマ区切り)(*.csv)」に変えたのちもう一度ファイルを読み込む
```{r}
for(i in 1:no_sample) {
  print(i)
  raw_data[[i]] <- read.csv(as.character(phyto_metadata$file[i]), header = T)
}
```
### 5.1.2 エクセルにデータを整理した時に余分な行や列が追加されてしまうミス

データ読み込み先であるraw_data(リスト)の5番目がおかしいことに気付くはず（意図的なエラー）
```{r}
raw_data[[5]]
```
37行目と4列目を取り除き[-37, -4], 取り除いたものを上書きすればよい
```{r}
raw_data[[5]] <- raw_data[[5]][-37, -4]
raw_data[[5]] #上書き後のデータを確認
```


